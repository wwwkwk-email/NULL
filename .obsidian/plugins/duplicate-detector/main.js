/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var d=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var x=(s,e)=>{for(var i in e)d(s,i,{get:e[i],enumerable:!0})},P=(s,e,i,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of V(e))!_.call(s,n)&&n!==i&&d(s,n,{get:()=>e[n],enumerable:!(t=E(e,n))||t.enumerable});return s};var C=s=>P(d({},"__esModule",{value:!0}),s);var v={};x(v,{default:()=>h,duplicateDetectorPluginSettings:()=>r});module.exports=C(v);var m=require("obsidian");var l=require("obsidian");var c=require("@codemirror/view"),f=require("@codemirror/state"),b=require("obsidian");var a=class{constructor(e){this.decorations=this._buildDecorations(e,null),this._lastView=e,a.instance=this}update(e){this._lastView=e.view,(e.docChanged||e.viewportChanged)&&(this.decorations=this._buildDecorations(e.view,e))}destroy(){}refresh(){this.decorations=this._buildDecorations(this._lastView,null)}_buildDecorations(e,i){let t=new f.RangeSetBuilder;if(!r.enableHighlighting&&!r.enableNotices)return t.finish();for(let n=1;n<=e.state.doc.lines;n++){let o=e.state.doc.line(n);if(o.text=="")continue;if(this._isInViewport(o,e)){let u=this._getDuplicate(o,e);u&&(r.enableHighlighting&&t.add(o.from,o.to,this._buildDecoration(u)),r.enableNotices&&this._wasChanged(o,i)&&this._showDuplicationNotice(o,u))}}return t.finish()}_isInViewport(e,i){for(let{from:t,to:n}of i.visibleRanges)if(this._overlapsIncluding(e.from,e.to,t,n))return!0;return!1}_overlapsIncluding(e,i,t,n){return e>=t&&e<=n||i>=t&&i<=n||e<t&&i>n||t<e&&n>i}_overlapsExcluding(e,i,t,n){return e>t&&e<n||i>t&&i<n||e<=t&&i>=n||t<=e&&n>=i}_getDuplicate(e,i){for(let t=1;t<=i.state.doc.lines;t++){let n=i.state.doc.line(t);if(n.number!=e.number&&e.text==n.text)return n}return null}_wasChanged(e,i){if(!i)return!1;let t=!1;return i.changes.iterChanges((n,o,p,u,S)=>{this._overlapsExcluding(e.from,e.to,p,u)&&S.toString().contains(e.text)&&(t=!0)}),t}_buildDecoration(e){return c.Decoration.mark({attributes:{style:`background-color: ${r.highlightColor};`,title:`Duplicated on line ${e.number}`}})}_showDuplicationNotice(e,i){new b.Notice(`Duplicate line inserted: ${e.number} -- ${i.number}`,5e3)}},N={decorations:s=>s.decorations},D=c.ViewPlugin.fromClass(a,N);var w={enableHighlighting:!0,enableNotices:!0,highlightColor:"#505000"},g=class extends l.PluginSettingTab{constructor(i,t){super(i,t);this.plugin=t}display(){let{containerEl:i}=this;i.empty(),new l.Setting(i).setName("Enable highlighting").setDesc("Enable highlighting of duplicate lines in editor").addToggle(t=>t.setValue(r.enableHighlighting).onChange(async n=>{var o;r.enableHighlighting=n,await this.plugin.saveSettings(),(o=a.instance)==null||o.refresh()})),new l.Setting(i).setName("Enable notices").setDesc("Show a notice when pasting a duplicated line").addToggle(t=>t.setValue(r.enableNotices).onChange(async n=>{r.enableNotices=n,await this.plugin.saveSettings()})),new l.Setting(i).setName("Highlight color").setDesc("Change the highlight color for duplicated lines").addColorPicker(t=>t.setValue(r.highlightColor).onChange(async n=>{var o;r.highlightColor=n,await this.plugin.saveSettings(),(o=a.instance)==null||o.refresh()}))}};var r,h=class extends m.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new g(this.app,this)),this.registerEditorExtension(D)}onunload(){}async loadSettings(){r=Object.assign({},w,await this.loadData())}async saveSettings(){await this.saveData(r)}};

/* nosourcemap */